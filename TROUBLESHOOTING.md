# ğŸ”§ æ•…éšœæ’æŸ¥æŒ‡å—

## é—®é¢˜ï¼šåå°ç®¡ç†é¡µé¢æ— æ³•è¿æ¥åˆ°åç«¯ API

### é”™è¯¯ä¿¡æ¯
```
net::ERR_FAILED
âŒ ç½‘ç»œè¯·æ±‚å¤±è´¥: https://video-app-backend-215072-7-1319956699.sh.run.tcloudbase.com/api/users
TypeError: Failed to fetch
```

### æ’æŸ¥æ­¥éª¤

#### 1. æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ

**æ–¹æ³• 1: è®¿é—®å¥åº·æ£€æŸ¥ç«¯ç‚¹**

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š
```
https://video-app-backend-215072-7-1319956699.sh.run.tcloudbase.com/api/health
```

**é¢„æœŸç»“æœ**:
- âœ… æˆåŠŸï¼šè¿”å› `{"status":"OK","timestamp":"...","uptime":...}`
- âŒ å¤±è´¥ï¼šæ— æ³•è®¿é—®æˆ–è¿”å›é”™è¯¯

**å¦‚æœæ— æ³•è®¿é—®**:
- åç«¯æœåŠ¡å¯èƒ½æ²¡æœ‰è¿è¡Œ
- éœ€è¦æ£€æŸ¥ CloudBase Run æœåŠ¡çŠ¶æ€
- æŸ¥çœ‹ CloudBase Run çš„æ—¥å¿—ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯

**æ–¹æ³• 2: è®¿é—®æ ¹è·¯å¾„**

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š
```
https://video-app-backend-215072-7-1319956699.sh.run.tcloudbase.com/
```

**é¢„æœŸç»“æœ**:
- âœ… æˆåŠŸï¼šè¿”å› API ä¿¡æ¯ JSON
- âŒ å¤±è´¥ï¼šæ— æ³•è®¿é—®æˆ–è¿”å›é”™è¯¯

#### 2. æ£€æŸ¥ CloudBase Run æœåŠ¡çŠ¶æ€

1. ç™»å½•è…¾è®¯äº‘ CloudBase æ§åˆ¶å°
2. è¿›å…¥ **äº‘å¼€å‘** â†’ **äº‘æ‰˜ç®¡** â†’ **æœåŠ¡ç®¡ç†**
3. æ‰¾åˆ°ä½ çš„åç«¯æœåŠ¡ï¼ˆ`video-app-backend`ï¼‰
4. æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š
   - âœ… **è¿è¡Œä¸­**ï¼šæœåŠ¡æ­£å¸¸
   - âŒ **å·²åœæ­¢**ï¼šéœ€è¦å¯åŠ¨æœåŠ¡
   - âŒ **å¼‚å¸¸**ï¼šæŸ¥çœ‹æ—¥å¿—æ’æŸ¥é—®é¢˜

#### 3. æ£€æŸ¥ CloudBase Run æ—¥å¿—

1. åœ¨æœåŠ¡è¯¦æƒ…é¡µé¢ï¼Œç‚¹å‡» **æ—¥å¿—** æ ‡ç­¾
2. æŸ¥çœ‹æœ€è¿‘çš„æ—¥å¿—ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
3. å¸¸è§é”™è¯¯ï¼š
   - ç«¯å£é…ç½®é”™è¯¯
   - ç¯å¢ƒå˜é‡ç¼ºå¤±
   - ä¾èµ–å®‰è£…å¤±è´¥
   - åº”ç”¨å¯åŠ¨å¤±è´¥

#### 4. æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®

åœ¨ CloudBase Run æœåŠ¡é…ç½®ä¸­ï¼Œç¡®ä¿ä»¥ä¸‹ç¯å¢ƒå˜é‡å·²æ­£ç¡®é…ç½®ï¼š

**å¿…éœ€çš„ç¯å¢ƒå˜é‡**:
```
PORT=3001
NODE_ENV=production
FRONTEND_URL=https://video-app-env-8gpoewzu84d85ace-1319956699.tcloudbaseapp.com/Video-frontend
ADMIN_URL=https://video-app-env-8gpoewzu84d85ace-1319956699.tcloudbaseapp.com/Video-admin
```

**LeanCloud é…ç½®**:
```
LEANCLOUD_APP_ID=RDeCDLtbY5VWuuVuOV8GUfbl-gzGzoHsz
LEANCLOUD_APP_KEY=1w0cQLBZIaJ32tjaU7RkDu3n
LEANCLOUD_MASTER_KEY=Ub2GDZGGNo0NuUOvDRheK04Y
LEANCLOUD_SERVER_URL=https://rdecdltb.lc-cn-n1-shared.com
```

**âš ï¸ é‡è¦**: 
- `FRONTEND_URL` å’Œ `ADMIN_URL` å¿…é¡»åŒ…å«å®Œæ•´çš„ URLï¼ˆåŒ…æ‹¬åè®® `https://`ï¼‰
- ä¸è¦åŒ…å«æœ«å°¾çš„æ–œæ  `/`
- ç¡®ä¿æ‰€æœ‰ç¯å¢ƒå˜é‡éƒ½å·²æ­£ç¡®è®¾ç½®

#### 5. æ£€æŸ¥ CORS é…ç½®

åç«¯ä»£ç å·²è‡ªåŠ¨æ”¯æŒ CloudBase åŸŸåï¼Œä½†éœ€è¦ç¡®ä¿ï¼š

1. **ç¯å¢ƒå˜é‡å·²è®¾ç½®**: `FRONTEND_URL` å’Œ `ADMIN_URL` å¿…é¡»æ­£ç¡®é…ç½®
2. **NODE_ENV=production**: ç¡®ä¿è®¾ç½®ä¸º `production`
3. **æœåŠ¡å·²é‡å¯**: ä¿®æ”¹ç¯å¢ƒå˜é‡åéœ€è¦é‡å¯æœåŠ¡

#### 6. æ£€æŸ¥ç«¯å£é…ç½®

1. åœ¨ CloudBase Run æœåŠ¡é…ç½®ä¸­ï¼Œæ£€æŸ¥ **æœåŠ¡ç«¯å£**
2. ç¡®ä¿ç«¯å£è®¾ç½®ä¸º `3001`
3. ç¡®ä¿ç¯å¢ƒå˜é‡ `PORT=3001` ä¸é…ç½®çš„ç«¯å£ä¸€è‡´

#### 7. æ£€æŸ¥ç½‘ç»œè¿æ¥

**åœ¨æµè§ˆå™¨æ§åˆ¶å°æµ‹è¯•**:

æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼Œåœ¨ Console ä¸­è¿è¡Œï¼š

```javascript
// æµ‹è¯•å¥åº·æ£€æŸ¥ç«¯ç‚¹
fetch('https://video-app-backend-215072-7-1319956699.sh.run.tcloudbase.com/api/health')
  .then(res => res.json())
  .then(data => console.log('âœ… åç«¯æœåŠ¡æ­£å¸¸:', data))
  .catch(err => console.error('âŒ åç«¯æœåŠ¡å¼‚å¸¸:', err));

// æµ‹è¯•ç”¨æˆ·åˆ—è¡¨ç«¯ç‚¹
fetch('https://video-app-backend-215072-7-1319956699.sh.run.tcloudbase.com/api/users?page=1&limit=20')
  .then(res => res.json())
  .then(data => console.log('âœ… API è¯·æ±‚æˆåŠŸ:', data))
  .catch(err => console.error('âŒ API è¯·æ±‚å¤±è´¥:', err));
```

**é¢„æœŸç»“æœ**:
- âœ… æˆåŠŸï¼šè¿”å›æ•°æ®
- âŒ å¤±è´¥ï¼šæ£€æŸ¥é”™è¯¯ä¿¡æ¯

#### 8. æ£€æŸ¥ SSL/HTTPS è¯ä¹¦

å¦‚æœè®¿é—®åç«¯ URL æ—¶å‡ºç° SSL è¯ä¹¦é”™è¯¯ï¼š
1. æ£€æŸ¥ CloudBase Run æœåŠ¡çš„ SSL é…ç½®
2. ç¡®ä¿ä½¿ç”¨ HTTPS åè®®
3. å¦‚æœä½¿ç”¨è‡ªå®šä¹‰åŸŸåï¼Œç¡®ä¿ SSL è¯ä¹¦å·²æ­£ç¡®é…ç½®

### å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ

#### é—®é¢˜ 1: åç«¯æœåŠ¡æ— æ³•è®¿é—®

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ CloudBase Run æœåŠ¡æ˜¯å¦å·²å¯åŠ¨
2. æ£€æŸ¥æœåŠ¡ç«¯å£é…ç½®æ˜¯å¦æ­£ç¡®
3. æŸ¥çœ‹æœåŠ¡æ—¥å¿—ï¼Œæ’æŸ¥å¯åŠ¨é”™è¯¯
4. ç¡®ä¿ Dockerfile é…ç½®æ­£ç¡®

#### é—®é¢˜ 2: CORS é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®ä¿ç¯å¢ƒå˜é‡ `FRONTEND_URL` å’Œ `ADMIN_URL` å·²æ­£ç¡®é…ç½®
2. ç¡®ä¿ `NODE_ENV=production`
3. é‡å¯åç«¯æœåŠ¡
4. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„ CORS é”™è¯¯ä¿¡æ¯

#### é—®é¢˜ 3: ç¯å¢ƒå˜é‡æœªç”Ÿæ•ˆ

**è§£å†³æ–¹æ¡ˆ**:
1. åœ¨ CloudBase Run æ§åˆ¶å°æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®
2. ç¡®ä¿ç¯å¢ƒå˜é‡åç§°æ­£ç¡®ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰
3. ç¡®ä¿ç¯å¢ƒå˜é‡å€¼æ­£ç¡®ï¼ˆä¸è¦æœ‰å¤šä½™çš„ç©ºæ ¼ï¼‰
4. é‡å¯æœåŠ¡ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ

#### é—®é¢˜ 4: ç«¯å£é…ç½®é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®ä¿ CloudBase Run æœåŠ¡ç«¯å£è®¾ç½®ä¸º `3001`
2. ç¡®ä¿ç¯å¢ƒå˜é‡ `PORT=3001`
3. æ£€æŸ¥ Dockerfile ä¸­çš„ `EXPOSE 3001`
4. é‡å¯æœåŠ¡

### è”ç³»æ”¯æŒ

å¦‚æœä»¥ä¸Šæ­¥éª¤éƒ½æ— æ³•è§£å†³é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **åç«¯æœåŠ¡çŠ¶æ€**: CloudBase Run æœåŠ¡æ˜¯å¦è¿è¡Œä¸­
2. **æœåŠ¡æ—¥å¿—**: æœ€è¿‘çš„é”™è¯¯æ—¥å¿—
3. **ç¯å¢ƒå˜é‡é…ç½®**: å·²é…ç½®çš„ç¯å¢ƒå˜é‡åˆ—è¡¨ï¼ˆéšè—æ•æ„Ÿä¿¡æ¯ï¼‰
4. **æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯**: å®Œæ•´çš„é”™è¯¯ä¿¡æ¯
5. **ç½‘ç»œæµ‹è¯•ç»“æœ**: å¥åº·æ£€æŸ¥ç«¯ç‚¹çš„è®¿é—®ç»“æœ

---

## é—®é¢˜ï¼šç”Ÿæˆè§†é¢‘æ—¶æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡å™¨

### é”™è¯¯ä¿¡æ¯
```
âŒ ç”Ÿæˆæ— å£°è§†é¢‘APIè°ƒç”¨å¤±è´¥: Error: æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡å™¨ (https://video-app-backend-215072-7-1319956699.sh.run.tcloudbase.com/api)
```

### æ’æŸ¥æ­¥éª¤

#### 1. æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ

**è®¿é—®å¥åº·æ£€æŸ¥ç«¯ç‚¹**ï¼š
```
https://video-app-backend-215072-7-1319956699.sh.run.tcloudbase.com/api/health
```

**é¢„æœŸç»“æœ**ï¼š
- âœ… æˆåŠŸï¼šè¿”å› `{"status":"OK","timestamp":"...","uptime":...}`
- âŒ å¤±è´¥ï¼šæ— æ³•è®¿é—®æˆ–è¿”å›é”™è¯¯

#### 2. æ£€æŸ¥ CORS é…ç½®

ç¡®ä¿åç«¯æœåŠ¡å·²é‡æ–°éƒ¨ç½²ï¼ŒCORS é…ç½®å·²æ›´æ–°ï¼š
- CloudBase åŸŸååº”è¯¥è¢«å…è®¸
- æ£€æŸ¥æœåŠ¡æ—¥å¿—ä¸­çš„ CORS æ£€æŸ¥ä¿¡æ¯

#### 3. æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®

ç¡®ä¿åå°ç®¡ç†ç•Œé¢åœ¨ CloudBase é™æ€ç½‘ç«™æ‰˜ç®¡ä¸­é…ç½®äº†æ­£ç¡®çš„ç¯å¢ƒå˜é‡ï¼š

```
VITE_API_BASE_URL=https://video-app-backend-215072-7-1319956699.sh.run.tcloudbase.com/api
```

**âš ï¸ é‡è¦**ï¼š
- `VITE_API_BASE_URL` å¿…é¡»ä»¥ `/api` ç»“å°¾
- ç¡®ä¿ç¯å¢ƒå˜é‡å·²æ­£ç¡®è®¾ç½®
- ä¿®æ”¹ç¯å¢ƒå˜é‡åéœ€è¦é‡æ–°éƒ¨ç½²å‰ç«¯åº”ç”¨

#### 4. æ£€æŸ¥ç½‘ç»œè¿æ¥

åœ¨æµè§ˆå™¨æ§åˆ¶å°æµ‹è¯• API è¿æ¥ï¼š

```javascript
// æµ‹è¯•å¥åº·æ£€æŸ¥
fetch('https://video-app-backend-215072-7-1319956699.sh.run.tcloudbase.com/api/health')
  .then(res => res.json())
  .then(data => console.log('âœ… åç«¯æœåŠ¡æ­£å¸¸:', data))
  .catch(err => console.error('âŒ åç«¯æœåŠ¡å¼‚å¸¸:', err));

// æµ‹è¯•è§†é¢‘ç”Ÿæˆç«¯ç‚¹ï¼ˆéœ€è¦è®¤è¯ï¼‰
fetch('https://video-app-backend-215072-7-1319956699.sh.run.tcloudbase.com/api/books/content/test-id/generate-silent-video', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer your-token'
  }
})
  .then(res => res.json())
  .then(data => console.log('âœ… API è¯·æ±‚æˆåŠŸ:', data))
  .catch(err => console.error('âŒ API è¯·æ±‚å¤±è´¥:', err));
```

#### 5. æ£€æŸ¥æœåŠ¡æ—¥å¿—

åœ¨ CloudBase Run æœåŠ¡æ—¥å¿—ä¸­æŸ¥æ‰¾ï¼š
- CORS æ£€æŸ¥æ—¥å¿—
- API è¯·æ±‚æ—¥å¿—
- é”™è¯¯ä¿¡æ¯

**å¸¸è§æ—¥å¿—**ï¼š
```
ğŸŒ CORS: Checking origin: https://video-app-env-8gpoewzu84d85ace-1319956699.tcloudbaseapp.com
âœ… CORS: Allowing CloudBase origin: https://video-app-env-8gpoewzu84d85ace-1319956699.tcloudbaseapp.com
ğŸŒ API CALL: POST /api/books/content/xxx/generate-silent-video
```

---

**æœ€åæ›´æ–°**: 2026-01-07

