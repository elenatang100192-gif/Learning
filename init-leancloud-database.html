<!DOCTYPE html>
<html>
<head>
    <title>LeanCloudæ•°æ®åº“åˆå§‹åŒ–</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; max-width: 800px; margin: 0 auto; }
        .step { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; border: none; border-radius: 3px; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .primary { background-color: #007bff; color: white; }
        .primary:hover:not(:disabled) { background-color: #0056b3; }
        .secondary { background-color: #6c757d; color: white; }
        .secondary:hover:not(:disabled) { background-color: #545b62; }
        pre { background: #f4f4f4; padding: 10px; border-radius: 3px; overflow-x: auto; }
        .header { text-align: center; margin-bottom: 30px; }
        .progress { margin: 10px 0; }
        .progress-bar { height: 20px; background-color: #007bff; border-radius: 10px; transition: width 0.3s; }
        .progress-container { height: 20px; background-color: #e9ecef; border-radius: 10px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ—„ï¸ LeanCloudæ•°æ®åº“åˆå§‹åŒ–å·¥å…·</h1>
        <p>ç”¨äºåˆå§‹åŒ–çŸ¥è¯†è§†é¢‘APPçš„æ•°æ®åº“ç»“æ„å’ŒåŸºç¡€æ•°æ®</p>
        <p><small>App ID: RDeCDLtbY5VWuuVuOV8GUfbl-gzGzoHsz</small></p>
    </div>

    <div id="status" class="step info">
        <strong>ğŸ“‹ çŠ¶æ€ï¼š</strong>å‡†å¤‡å°±ç»ªï¼Œè¯·æŒ‰é¡ºåºæ‰§è¡Œåˆå§‹åŒ–æ­¥éª¤
    </div>

    <div class="step">
        <h3>ğŸ”— æ­¥éª¤1: åˆå§‹åŒ–LeanCloudè¿æ¥</h3>
        <button onclick="initLeanCloud()" class="primary" id="connectBtn">è¿æ¥LeanCloud</button>
        <div id="connection-status"></div>
    </div>

    <div class="step">
        <h3>ğŸ“‚ æ­¥éª¤2: åˆ›å»ºåˆ†ç±»æ•°æ®</h3>
        <p>åˆ›å»ºä¸‰ä¸ªè§†é¢‘åˆ†ç±»ï¼šç§‘æŠ€ã€è‰ºæœ¯äººæ–‡ã€å•†ä¸šä¸šåŠ¡</p>
        <button onclick="createCategories()" class="primary" id="createCategoriesBtn" disabled>åˆ›å»ºåˆ†ç±»</button>
        <div id="categories-status"></div>
        <div class="progress" id="categories-progress" style="display: none;">
            <div class="progress-container">
                <div class="progress-bar" id="categories-bar" style="width: 0%"></div>
            </div>
        </div>
    </div>

    <div class="step">
        <h3>ğŸ“š æ­¥éª¤3: åˆ›å»ºç¤ºä¾‹ä¹¦ç±</h3>
        <p>åˆ›å»ºä¸‰æœ¬ç¤ºä¾‹ä¹¦ç±ç”¨äºæµ‹è¯•</p>
        <button onclick="createSampleBooks()" class="primary" id="createBooksBtn" disabled>åˆ›å»ºç¤ºä¾‹ä¹¦ç±</button>
        <div id="books-status"></div>
        <div class="progress" id="books-progress" style="display: none;">
            <div class="progress-container">
                <div class="progress-bar" id="books-bar" style="width: 0%"></div>
            </div>
        </div>
    </div>

    <div class="step">
        <h3>ğŸ¬ æ­¥éª¤4: åˆ›å»ºç¤ºä¾‹è§†é¢‘</h3>
        <p>åˆ›å»ºä¸‰ä¸ªç¤ºä¾‹è§†é¢‘ç”¨äºæµ‹è¯•æ’­æ”¾åŠŸèƒ½</p>
        <button onclick="createSampleVideos()" class="primary" id="createVideosBtn" disabled>åˆ›å»ºç¤ºä¾‹è§†é¢‘</button>
        <div id="videos-status"></div>
        <div class="progress" id="videos-progress" style="display: none;">
            <div class="progress-container">
                <div class="progress-bar" id="videos-bar" style="width: 0%"></div>
            </div>
        </div>
    </div>

    <div class="step">
        <h3>ğŸ“Š æ­¥éª¤5: åˆ›å»ºæ¯æ—¥ç»Ÿè®¡è®°å½•</h3>
        <p>åˆ›å»ºä»Šæ—¥çš„ç»Ÿè®¡æ•°æ®è®°å½•</p>
        <button onclick="createStatistics()" class="primary" id="createStatsBtn" disabled>åˆ›å»ºç»Ÿè®¡æ•°æ®</button>
        <div id="stats-status"></div>
    </div>

    <div class="step warning">
        <h3>âš ï¸ æ³¨æ„äº‹é¡¹</h3>
        <ul>
            <li>è¯·ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸</li>
            <li>åˆå§‹åŒ–è¿‡ç¨‹ä¸­è¯·å‹¿å…³é—­é¡µé¢</li>
            <li>å¦‚æœæŸæ­¥éª¤å¤±è´¥ï¼Œå¯ä»¥å•ç‹¬é‡æ–°æ‰§è¡Œ</li>
            <li>åˆå§‹åŒ–å®Œæˆåï¼Œå»ºè®®åœ¨LeanCloudæ§åˆ¶å°éªŒè¯æ•°æ®</li>
        </ul>
    </div>

    <div class="step success">
        <h3>âœ… å®Œæˆ</h3>
        <p>åˆå§‹åŒ–å®Œæˆåï¼Œæ‚¨å¯ä»¥åœ¨LeanCloudæ§åˆ¶å°æŸ¥çœ‹åˆ›å»ºçš„æ•°æ®ã€‚</p>
        <p><strong>æ§åˆ¶å°åœ°å€ï¼š</strong> <a href="https://leancloud.cn/dashboard/" target="_blank">https://leancloud.cn/dashboard/</a></p>
        <p><strong>åº”ç”¨åç§°ï¼š</strong> knowledge-video-app</p>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4/dist/av-min.js"></script>
    <script>
        let isConnected = false;

        // LeanCloudé…ç½®
        const LEANCLOUD_CONFIG = {
            appId: 'RDeCDLtbY5VWuuVuOV8GUfbl-gzGzoHsz',
            appKey: '1w0cQLBZIaJ32tjaU7RkDu3n',
            serverURL: 'https://rdecdltb.lc-cn-n1-shared.com'
        };

        async function initLeanCloud() {
            const btn = document.getElementById('connectBtn');
            const statusDiv = document.getElementById('connection-status');

            btn.disabled = true;
            btn.textContent = 'è¿æ¥ä¸­...';
            statusDiv.innerHTML = 'æ­£åœ¨è¿æ¥LeanCloud...';

            try {
                AV.init(LEANCLOUD_CONFIG);

                // æµ‹è¯•è¿æ¥
                const testQuery = new AV.Query('_User');
                testQuery.limit(1);
                await testQuery.find();

                statusDiv.innerHTML = '<span style="color: green;">âœ“ LeanCloudè¿æ¥æˆåŠŸï¼åº”ç”¨é…ç½®æ­£ç¡®ã€‚</span>';
                document.getElementById('createCategoriesBtn').disabled = false;
                isConnected = true;
                btn.textContent = 'å·²è¿æ¥';
                btn.className = 'secondary';

            } catch (error) {
                statusDiv.innerHTML = '<span style="color: red;">âœ— è¿æ¥å¤±è´¥: ' + error.message + '</span>';
                btn.disabled = false;
                btn.textContent = 'é‡è¯•è¿æ¥';
            }
        }

        async function createCategories() {
            if (!isConnected) {
                alert('è¯·å…ˆè¿æ¥LeanCloud');
                return;
            }

            const statusDiv = document.getElementById('categories-status');
            const progressDiv = document.getElementById('categories-progress');
            const progressBar = document.getElementById('categories-bar');
            const btn = document.getElementById('createCategoriesBtn');

            btn.disabled = true;
            btn.textContent = 'åˆ›å»ºä¸­...';
            statusDiv.innerHTML = 'æ­£åœ¨åˆ›å»ºåˆ†ç±»...';
            progressDiv.style.display = 'block';

            try {
                const categories = [
                    { name: 'Tech', nameCn: 'ç§‘æŠ€', sortOrder: 1 },
                    { name: 'Arts', nameCn: 'è‰ºæœ¯äººæ–‡', sortOrder: 2 },
                    { name: 'Business', nameCn: 'å•†ä¸šä¸šåŠ¡', sortOrder: 3 }
                ];

                for (let i = 0; i < categories.length; i++) {
                    const cat = categories[i];
                    const Category = AV.Object.extend('Category');
                    const category = new Category();
                    category.set('name', cat.name);
                    category.set('nameCn', cat.nameCn);
                    category.set('sortOrder', cat.sortOrder);
                    await category.save();

                    statusDiv.innerHTML += `<br>âœ“ åˆ›å»ºåˆ†ç±»: ${cat.nameCn}`;
                    progressBar.style.width = `${((i + 1) / categories.length) * 100}%`;
                }

                statusDiv.innerHTML += '<br><span style="color: green;">åˆ†ç±»åˆ›å»ºå®Œæˆï¼</span>';
                document.getElementById('createBooksBtn').disabled = false;
                btn.textContent = 'å·²å®Œæˆ';
                btn.className = 'secondary';

            } catch (error) {
                statusDiv.innerHTML += `<br><span style="color: red;">âœ— åˆ›å»ºå¤±è´¥: ${error.message}</span>`;
                btn.disabled = false;
                btn.textContent = 'é‡è¯•åˆ›å»º';
            }
        }

        async function createSampleBooks() {
            const statusDiv = document.getElementById('books-status');
            const progressDiv = document.getElementById('books-progress');
            const progressBar = document.getElementById('books-bar');
            const btn = document.getElementById('createBooksBtn');

            btn.disabled = true;
            btn.textContent = 'åˆ›å»ºä¸­...';
            statusDiv.innerHTML = 'æ­£åœ¨åˆ›å»ºç¤ºä¾‹ä¹¦ç±...';
            progressDiv.style.display = 'block';

            try {
                // è·å–åˆ†ç±»
                const Category = AV.Object.extend('Category');
                const categoryQuery = new AV.Query(Category);
                const categories = await categoryQuery.find();

                const categoryMap = {};
                categories.forEach(cat => {
                    categoryMap[cat.get('name')] = cat;
                });

                const sampleBooks = [
                    {
                        title: 'æ·±åº¦å­¦ä¹ ',
                        author: 'Ian Goodfellow',
                        isbn: '9787115434281',
                        category: 'Tech',
                        description: 'æ·±åº¦å­¦ä¹ ç»å…¸æ•™æï¼Œå…¨é¢ä»‹ç»æ·±åº¦å­¦ä¹ ç†è®ºä¸å®è·µ'
                    },
                    {
                        title: 'ç™¾å¹´å­¤ç‹¬',
                        author: 'åŠ è¥¿äºšÂ·é©¬å°”å…‹æ–¯',
                        isbn: '9787532768849',
                        category: 'Arts',
                        description: 'é­”å¹»ç°å®ä¸»ä¹‰æ–‡å­¦å·…å³°ä¹‹ä½œï¼Œè®²è¿°å¸ƒæ©è¿ªäºšå®¶æ—ä¸ƒä»£äººçš„ä¼ å¥‡æ•…äº‹'
                    },
                    {
                        title: 'å½±å“åŠ›',
                        author: 'ç½—ä¼¯ç‰¹Â·è¥¿å¥¥è¿ªå°¼',
                        isbn: '9787508667168',
                        category: 'Business',
                        description: 'å¿ƒç†å­¦ä¸è¥é”€å­¦çš„ç»å…¸ä¹‹ä½œï¼Œæ­ç¤ºäººç±»è¡Œä¸ºèƒŒåçš„è§„å¾‹'
                    }
                ];

                for (let i = 0; i < sampleBooks.length; i++) {
                    const bookData = sampleBooks[i];
                    const Book = AV.Object.extend('Book');
                    const book = new Book();

                    book.set('title', bookData.title);
                    book.set('author', bookData.author);
                    book.set('isbn', bookData.isbn);
                    book.set('category', categoryMap[bookData.category]);
                    book.set('uploadDate', new Date().toISOString().split('T')[0]);
                    book.set('status', 'å¾…å¤„ç†');

                    await book.save();
                    statusDiv.innerHTML += `<br>âœ“ åˆ›å»ºä¹¦ç±: ${bookData.title}`;
                    progressBar.style.width = `${((i + 1) / sampleBooks.length) * 100}%`;
                }

                statusDiv.innerHTML += '<br><span style="color: green;">ç¤ºä¾‹ä¹¦ç±åˆ›å»ºå®Œæˆï¼</span>';
                document.getElementById('createVideosBtn').disabled = false;
                btn.textContent = 'å·²å®Œæˆ';
                btn.className = 'secondary';

            } catch (error) {
                statusDiv.innerHTML += `<br><span style="color: red;">âœ— åˆ›å»ºå¤±è´¥: ${error.message}</span>`;
                btn.disabled = false;
                btn.textContent = 'é‡è¯•åˆ›å»º';
            }
        }

        async function createSampleVideos() {
            const statusDiv = document.getElementById('videos-status');
            const progressDiv = document.getElementById('videos-progress');
            const progressBar = document.getElementById('videos-bar');
            const btn = document.getElementById('createVideosBtn');

            btn.disabled = true;
            btn.textContent = 'åˆ›å»ºä¸­...';
            statusDiv.innerHTML = 'æ­£åœ¨åˆ›å»ºç¤ºä¾‹è§†é¢‘...';
            progressDiv.style.display = 'block';

            try {
                // è·å–ä¹¦ç±å’Œåˆ†ç±»
                const Book = AV.Object.extend('Book');
                const bookQuery = new AV.Query(Book);
                const books = await bookQuery.find();

                const Category = AV.Object.extend('Category');
                const categoryQuery = new AV.Query(Category);
                const categories = await categoryQuery.find();

                const categoryMap = {};
                categories.forEach(cat => {
                    categoryMap[cat.get('name')] = cat;
                });

                const sampleVideos = [
                    {
                        title: 'ç¥ç»ç½‘ç»œåŸºç¡€',
                        titleEn: 'Neural Network Basics',
                        category: 'Tech',
                        duration: 180,
                        description: 'æ·±åº¦å­¦ä¹ å…¥é—¨ï¼šç¥ç»ç½‘ç»œçš„åŸºæœ¬æ¦‚å¿µå’Œå·¥ä½œåŸç†'
                    },
                    {
                        title: 'é­”å¹»ç°å®ä¸»ä¹‰è§£æ',
                        titleEn: 'Analysis of Magical Realism',
                        category: 'Arts',
                        duration: 240,
                        description: 'æ–‡å­¦åˆ†æï¼šç™¾å¹´å­¤ç‹¬ä¸­çš„é­”å¹»ç°å®ä¸»ä¹‰æ‰‹æ³•'
                    },
                    {
                        title: 'è¯´æœåŠ›å¿ƒç†å­¦',
                        titleEn: 'Psychology of Persuasion',
                        category: 'Business',
                        duration: 200,
                        description: 'å½±å“åŠ›å‰–æï¼šå…­å¤§è¯´æœåŸåˆ™åœ¨å•†ä¸šä¸­çš„åº”ç”¨'
                    }
                ];

                for (let i = 0; i < sampleVideos.length; i++) {
                    const videoData = sampleVideos[i];
                    const Video = AV.Object.extend('Video');
                    const video = new Video();

                    video.set('title', videoData.title);
                    video.set('titleEn', videoData.titleEn);
                    video.set('category', categoryMap[videoData.category]);
                    video.set('book', books[i % books.length]); // å¾ªç¯åˆ†é…ä¹¦ç±
                    video.set('duration', videoData.duration);
                    video.set('fileSize', videoData.duration * 1024 * 1024); // ä¼°ç®—æ–‡ä»¶å¤§å°
                    video.set('status', 'å·²å‘å¸ƒ');
                    video.set('disabled', false);
                    video.set('viewCount', Math.floor(Math.random() * 1000));
                    video.set('likeCount', Math.floor(Math.random() * 100));
                    video.set('uploadDate', new Date().toISOString().split('T')[0]);
                    video.set('publishDate', new Date().toISOString().split('T')[0]);
                    video.set('aiExtractDate', new Date().toISOString().split('T')[0]);
                    video.set('coverUrl', 'https://images.unsplash.com/photo-1492619375914-88005aa9e8fb?w=400');

                    await video.save();
                    statusDiv.innerHTML += `<br>âœ“ åˆ›å»ºè§†é¢‘: ${videoData.title}`;
                    progressBar.style.width = `${((i + 1) / sampleVideos.length) * 100}%`;
                }

                statusDiv.innerHTML += '<br><span style="color: green;">ç¤ºä¾‹è§†é¢‘åˆ›å»ºå®Œæˆï¼</span>';
                document.getElementById('createStatsBtn').disabled = false;
                btn.textContent = 'å·²å®Œæˆ';
                btn.className = 'secondary';

            } catch (error) {
                statusDiv.innerHTML += `<br><span style="color: red;">âœ— åˆ›å»ºå¤±è´¥: ${error.message}</span>`;
                btn.disabled = false;
                btn.textContent = 'é‡è¯•åˆ›å»º';
            }
        }

        async function createStatistics() {
            const statusDiv = document.getElementById('stats-status');
            const btn = document.getElementById('createStatsBtn');

            btn.disabled = true;
            btn.textContent = 'åˆ›å»ºä¸­...';
            statusDiv.innerHTML = 'æ­£åœ¨åˆ›å»ºç»Ÿè®¡æ•°æ®...';

            try {
                const StatisticsDaily = AV.Object.extend('StatisticsDaily');
                const stats = new StatisticsDaily();

                const today = new Date().toISOString().split('T')[0];

                stats.set('date', today);
                stats.set('totalUsers', 0);
                stats.set('activeUsers', 0);
                stats.set('newUsers', 0);
                stats.set('totalVideos', 3);
                stats.set('newVideos', 3);
                stats.set('publishedVideos', 3);
                stats.set('totalViews', 1500);
                stats.set('totalLikes', 200);
                stats.set('totalComments', 0);
                stats.set('pendingAudits', 0);

                await stats.save();
                statusDiv.innerHTML += `<br>âœ“ åˆ›å»ºç»Ÿè®¡æ•°æ®: ${today}`;
                statusDiv.innerHTML += '<br><span style="color: green;">ç»Ÿè®¡æ•°æ®åˆ›å»ºå®Œæˆï¼</span>';

                btn.textContent = 'å·²å®Œæˆ';
                btn.className = 'secondary';

                document.getElementById('status').innerHTML =
                    '<strong>ğŸ“‹ çŠ¶æ€ï¼š</strong><span style="color: green;">æ‰€æœ‰åˆå§‹åŒ–æ­¥éª¤å·²å®Œæˆï¼æ‚¨ç°åœ¨å¯ä»¥åœ¨LeanCloudæ§åˆ¶å°æŸ¥çœ‹åˆ›å»ºçš„æ•°æ®ã€‚</span>';

            } catch (error) {
                statusDiv.innerHTML += `<br><span style="color: red;">âœ— åˆ›å»ºå¤±è´¥: ${error.message}</span>`;
                btn.disabled = false;
                btn.textContent = 'é‡è¯•åˆ›å»º';
            }
        }
    </script>
</body>
</html>
